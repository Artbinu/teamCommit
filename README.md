# 📜 급여 조회 프로그램 요구사항 (업데이트됨)

## 🔑 1. 로그인 기능  
- 관리자와 일반 사용자가 로그인 가능  
- 비밀번호 해시화하여 DB에 저장  
- 로그인 후 역할(`user` 또는 `admin`)에 따라 기능 접근 제한  
- **로그인 실패 보안 정책**  
  - 로그인 5회 연속 실패 시 **30분 동안 접속 불가**  
  - 로그인 성공 시 실패 횟수(`login_attempts`) 초기화  
  - 로그인 실패 횟수는 일정 시간이 지나면 초기화됨 (예: 24시간 후)  
  - 로그인 차단 시 사용자에게 알림 제공  
  - **로그인 실패 시 즉시 종료되지 않고, 사용자가 다시 입력 가능**  

## 🏷️ 2. 일반 사용자 기능 (`role='user'`)  
- 자신의 급여 정보만 조회 가능  

## 🛠️ 3. 관리자 기능 (`role='admin'`)  
- **급여 관리**  
  - 특정 사용자에게 급여 정보 추가  
  - 기존 급여 정보 수정  
  - 급여 정보 삭제  
- **사용자 관리**  
  - 사용자 목록 보기  
  - 사용자 등록 (관리자가 직접 아이디와 비밀번호 생성)  
  - 사용자 정보 수정  
  - 사용자 삭제  
  - 로그인 실패 기록 확인 가능  

## 🗄️ 4. DB 구조  
- `users` 테이블: 사용자 정보 저장  
  - `id`, `username`, `password_hash`, `role`, `login_attempts`, `lock_time`  
- `salaries` 테이블: 급여 정보 저장  
  - `id`, `user_id`, `base_salary`, `tax`, `net_salary`, `paid_date`  
- **로그인 실패 관리**  
  - 로그인 실패 횟수(`login_attempts`)와 계정 잠금 시간(`lock_time`)을 저장  
  - 로그인 성공 시 실패 횟수 초기화  

## 🔒 5. 보안 강화  
- **비밀번호 보안**: 복잡성 검사 (길이, 대소문자, 숫자, 특수문자 포함 여부 확인)  
- **세션 관리**: `Secure`, `HttpOnly` 옵션 사용하여 보안 강화  
- **입력값 검증**: SQL Injection 방지 및 유효성 검사 수행  
- **세션 만료**: 일정 시간 후 세션 자동 만료  
- **로그인 보안**  
  - 로그인 5회 실패 시 계정 30분 잠금 (`lock_time` 설정)  
  - 로그인 성공 시 실패 횟수(`login_attempts`) 초기화  
  - **로그인 실패 시 즉시 종료하지 않고, 사용자에게 재입력 요청**  

## 📜 6. 로그 기록 및 감사  
- 관리자와 사용자의 중요한 작업(급여 추가/수정/삭제, 로그인 실패 등) 기록  
- 감사 로그를 통해 사용자 및 관리자의 수행 작업 저장  
- 로그인 실패 기록 추가 (누적 실패 횟수, 계정 잠금 여부 확인 가능)  

## 📢 7. 알림 시스템  
- **급여 정보 업데이트:** 급여 정보 변경 시 관리자에게 알림 발송  
- **사용자 추가:** 관리자가 사용자를 추가할 때 알림 제공  
- **로그인 차단 알림:** 로그인 5회 실패 후 계정이 잠금될 경우 사용자에게 이메일 또는 시스템 알림 제공  

## 🔄 8. 기능 흐름  
- **로그인 페이지 (`/login`)**: 사용자 인증 후 역할에 따라 기능 접근  
- **관리자 대시보드 (`/admin`)**: 관리자만 접근 가능하며, 급여 추가/수정/삭제 및 사용자 관리 기능 제공  
- **사용자 급여 조회 페이지 (`/salary`)**: 사용자 본인의 급여 정보만 조회 가능  
- **로그 기록 및 알림 시스템 작동**  
- **로그인 실패 시 프로그램이 즉시 종료되지 않고, 사용자에게 재입력 기회 제공**  

## 💻 9. 서버 환경  
- **웹서버**: Ubuntu 20.04.6, Gunicorn 사용  
- **DB 서버**: NAS, MariaDB, 원격 접속 허용 (`payroll_db` 데이터베이스 및 사용자 계정 생성)  
- **서버 간 연결**: 웹서버와 DB 서버가 통신할 수 있도록 방화벽 설정 및 IP 허용  