# 📜 급여 조회 프로그램 요구사항 (최신 버전)

## 🔑 1. 로그인 기능
- 관리자와 일반 사용자가 로그인 가능
- 비밀번호 해시화하여 DB에 저장 (SHA-256 사용)
- 로그인 후 역할(user 또는 admin)에 따라 기능 접근 제한

### 🔒 로그인 실패 보안 정책
- 아이디와 비밀번호를 함께 입력받아 검증
- 로그인 실패 시 아이디 존재 여부를 숨기고 `"로그인 실패 다시 입력하세요"` 메시지 출력
- 로그인 5회 연속 실패 시 30분 동안 접속 불가
- 로그인 성공 시 실패 횟수 초기화
- 로그인 차단 시 사용자에게 알림 제공

## 🏷️ 2. 일반 사용자 기능 (role='user')
- 본인 급여 정보만 조회 가능

## 🛠 3. 관리자 기능 (role='admin')

### 💰 급여 관리
- 특정 사용자에게 급여 정보 추가
- 기존 급여 정보 수정
- 급여 정보 삭제

### 👥 사용자 관리
- 사용자 목록 보기
- 사용자 등록 (관리자가 직접 아이디와 비밀번호 생성)
- 사용자 정보 수정
- 사용자 삭제
- 로그인 실패 기록 확인 가능

## 🗄️ 4. DB 구조

### users 테이블 (사용자 정보 저장)
| 컬럼명         | 설명                    |
|--------------|-----------------------|
| id          | 사용자 ID (PK)          |
| username    | 사용자 이름             |
| password_hash | 비밀번호 해시값 (SHA-256) |
| role        | 사용자 역할 (admin/user) |
| login_attempts | 로그인 실패 횟수         |
| lock_time   | 계정 잠금 시간 (timestamp) |

### salaries 테이블 (급여 정보 저장)
| 컬럼명        | 설명               |
|-------------|----------------|
| id         | 급여 정보 ID (PK)  |
| user_id    | 사용자 ID (FK)   |
| base_salary | 기본 급여         |
| tax        | 세금 공제 금액    |
| net_salary | 실수령액         |
| paid_date  | 급여 지급일 (timestamp) |

### 🔹 로그인 실패 관리
- 로그인 실패 횟수(login_attempts)와 계정 잠금 시간(lock_time) 저장
- 로그인 성공 시 실패 횟수 초기화
- 전체 로그인 실패 횟수(global_login_attempts)를 관리하여 모든 사용자 실패 기록 유지

## 🔒 5. 보안 강화

### 🔑 비밀번호 보안
- 비밀번호 복잡성 검사 (길이, 대소문자, 숫자, 특수문자 포함 여부 확인)

### 🔐 세션 관리
- Secure, HttpOnly 옵션 사용하여 보안 강화
- 일정 시간 후 세션 자동 만료

### 🚨 로그인 보안
- 로그인 5회 실패 시 계정 30분 잠금 (lock_time 설정)
- 로그인 성공 시 실패 횟수(login_attempts) 초기화
- 로그인 실패 시 아이디 존재 여부 숨김

## 📜 6. 로그 기록 및 감사
- 관리자와 사용자의 중요한 작업 기록 (급여 추가/수정/삭제, 로그인 실패 등)
- 감사 로그를 통해 사용자 및 관리자의 수행 작업 저장
- 로그인 실패 기록 추가 (누적 실패 횟수, 계정 잠금 여부 확인 가능)

## 📢 7. 알림 시스템
- 급여 정보 업데이트 → 급여 변경 시 관리자에게 알림 발송
- 사용자 추가 → 관리자가 사용자를 추가하면 알림 제공
- 로그인 차단 알림 → 로그인 5회 실패 후 계정 잠금 시 사용자에게 이메일 또는 시스템 알림 제공

## 🔄 8. 기능 흐름

### 🌐 웹 기능 흐름
- **로그인 페이지** (`/login`) → 사용자 인증 후 역할에 따라 기능 접근
- **관리자 대시보드** (`/admin`) → 관리자만 접근 가능하며, 급여 추가/수정/삭제 및 사용자 관리 기능 제공
- **사용자 급여 조회 페이지** (`/salary`) → 사용자 본인의 급여 정보만 조회 가능
- 🚀 로그 기록 및 알림 시스템 작동
- 로그인 실패 시 프로그램이 즉시 종료되지 않고 사용자에게 재입력 기회 제공

## 💻 9. 서버 환경
- **웹서버:** Ubuntu 20.04.6, Gunicorn 사용
- **DB 서버:** NAS, MariaDB, 원격 접속 허용 (`payroll_db` 데이터베이스 및 사용자 계정 생성)
- **서버 간 연결:** 웹서버와 DB 서버가 통신할 수 있도록 방화벽 설정 및 IP 허용

## 🛠 10. 추가된 테스트 기능

### ✅ 유닛 테스트 기능 요구사항
#### 로그인 기능 테스트
- 올바른 아이디 & 비밀번호로 로그인 가능 여부 확인
- 잘못된 비밀번호 입력 시 로그인 실패 검증
- 로그인 5회 실패 시 차단 기능 검증
- 로그인 성공 후 실패 횟수 초기화 확인

#### 급여 조회 테스트
- 일반 사용자는 본인 급여만 조회 가능
- 관리자는 특정 사용자 급여 추가/수정/삭제 가능

#### 데이터베이스 테스트
- `connect_to_db()` 함수로 DB 연결 여부 확인
- `users` 및 `salaries` 테이블의 데이터 정상 삽입 및 조회 확인